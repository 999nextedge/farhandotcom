<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Professional Posting Website</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #fdfdfd;
    color: #222;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  a {
    color: #0c71c3;
    text-decoration: none;
    cursor: pointer;
  }
  a:hover {
    text-decoration: underline;
  }
  header {
    position: sticky;
    top: 0;
    background: #0c71c3;
    color: #fff;
    padding: 12px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 10;
    user-select: none;
  }
  #left-nav, #right-nav {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  #left-nav button,
  #right-nav button {
    font-size: 14px;
    cursor: pointer;
    background: transparent;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 4px;
    transition: background-color 0.25s ease;
    user-select: none;
  }
  #left-nav button:hover,
  #right-nav button:hover {
    background-color: rgba(255 255 255 / 0.25);
  }
  #left-nav button.active {
    background-color: rgba(255 255 255 / 0.40);
  }

  #main-container {
    flex: 1;
    display: flex;
    justify-content: center;
    padding: 20px 12px;
    max-width: 1100px;
    margin: 0 auto;
    width: 100%;
  }

  #posts-section {
    flex: 3;
    max-width: 700px;
    margin-right: 20px;
  }
  #posts-section h2 {
    margin-bottom: 12px;
    border-bottom: 2px solid #0c71c3;
    padding-bottom: 6px;
  }
  .post {
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 8px rgb(0 0 0 / 0.05);
    margin-bottom: 18px;
    padding: 14px 18px 12px 18px;
    position: relative;
  }
  .post-header {
    display: flex;
    justify-content: space-between;
    font-weight: 600;
    font-size: 18px;
    margin-bottom: 8px;
    user-select: text;
  }
  .post-title-date {
    user-select: text;
  }
  .caption {
    font-size: 15px;
    line-height: 1.3;
    margin-bottom: 12px;
    white-space: pre-wrap;
    user-select: text;
  }
  .post-media {
    display: flex;
    justify-content: center;
    margin-bottom: 12px;
    max-height: 380px;
    overflow: hidden;
    border-radius: 8px;
    background: #000;
  }
  .post-media img,
  .post-media video {
    max-width: 100%;
    max-height: 380px;
    display: block;
    border-radius: 8px;
    cursor: pointer;
  }
  .post-footer {
    display: flex;
    align-items: center;
    gap: 18px;
    font-size: 14px;
    user-select: none;
  }
  .post-footer button,
   .post-footer .copy-link {
    border: none;
    background: transparent;
    cursor: pointer;
    color: #0c71c3;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
    border-radius: 4px;
    padding: 5px 10px;
    transition: background-color 0.25s ease;
  }
  .post-footer button:hover,
   .post-footer .copy-link:hover {
    background-color: rgba(12 113 195 / 0.1);
  }
  .post-footer button:disabled {
    cursor: default;
    color: gray;
  }
  .like-count,
  .comment-count,
  .share-count {
    user-select: text;
  }
  .three-dots {
    position: absolute;
    top: 16px;
    right: 16px;
    font-weight: bold;
    font-size: 20px;
    cursor: pointer;
    color: #0c71c3;
    border: none;
    background: transparent;
    border-radius: 4px;
    width: 32px;
    height: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .three-dots:hover {
    background-color: rgba(12 113 195 / 0.15);
  }
  .comments-container {
    margin-top: 10px;
    max-height: 120px;
    overflow-y: auto;
    background: #f4f7fb;
    border-radius: 6px;
    padding: 6px 12px;
  }
  .comment {
    border-bottom: 1px solid #ddd;
    padding: 6px 0;
    font-size: 13px;
    word-break: break-word;
  }
  .comment:last-child {
    border-bottom: none;
  }
  #sidebar {
    flex: 1.2;
    max-width: 350px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 14px rgb(0 0 0 / 0.06);
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: fit-content;
  }
  #sidebar > h3 {
    border-bottom: 2px solid #0c71c3;
    padding-bottom: 6px;
  }
  #login-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  #login-form label {
    font-weight: 600;
  }
  #login-form input[type=email],
  #login-form input[type=password] {
    padding: 8px 10px;
    border-radius: 6px;
    border: 1.8px solid #bbb;
    font-size: 15px;
    outline-offset: 2px;
    outline-color: #0c71c3;
  }
  #login-form input:focus {
    border-color: #0c71c3;
  }
  #login-form button {
    background-color: #0c71c3;
    border: none;
    padding: 10px 14px;
    color: white;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  #login-form button:hover {
    background-color: #09589e;
  }
  #login-error {
    color: crimson;
    font-weight: 600;
    font-size: 14px;
  }
  #account-info {
    font-size: 14px;
  }
  #logout-button,
  #logout-button-sidebar {
    margin-top: 12px;
    align-self: flex-start;
    background: #e03c3c;
    color: white;
  }
  #account-stats {
    font-size: 14px;
  }
  #settings-section label,
  #post-editor-section label,
  #privacy-section label {
    font-weight: 600;
    margin-top: 10px;
    display: block;
  }
  #settings-section input[type=text],
  #settings-section input[type=url],
  #post-editor input[type=text],
  #post-editor textarea,
  #post-editor input[type=url],
  #privacy-section select {
    width: 100%;
    padding: 6px 10px;
    border-radius: 5px;
    border: 1.6px solid #ccc;
    margin-top: 4px;
    font-size: 14px;
  }
  #settings-section button,
  #post-editor button {
    margin-top: 12px;
    background-color: #0c71c3;
    border: none;
    padding: 8px 12px;
    color: white;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  #settings-section button:hover,
  #post-editor button:hover {
    background-color: #09589e;
  }
  #post-editor {
    display: none;
    flex-direction: column;
    gap: 12px;
  }
  #post-editor textarea {
    min-height: 80px;
    resize: vertical;
    font-family: inherit;
  }
  #post-editor input[type=file] {
    font-size: 14px;
  }
  #edit-modal {
    position: fixed;
    inset: 0;
    background-color: rgba(0,0,0,0.58);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  #edit-modal.active {
    display: flex;
  }
  #edit-modal .modal-content {
    background: white;
    border-radius: 12px;
    width: 360px;
    max-width: 90vw;
    padding: 20px 24px 24px 24px;
    box-shadow: 0 0 28px rgba(0,0,0,0.15);
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  #edit-modal h3 {
    margin: 0 0 12px 0;
  }
  #edit-modal label {
    font-weight: 600;
  }
  #edit-modal input[type=text],
  #edit-modal textarea,
  #edit-modal input[type=date],
  #edit-modal input[type=url],
  #edit-modal input[type=file] {
    width: 100%;
    padding: 7px 10px;
    border-radius: 6px;
    border: 1.8px solid #aaa;
    font-size: 14px;
  }
  #edit-modal textarea {
    min-height: 80px;
    resize: vertical;
  }
  #edit-modal button {
    background-color: #0c71c3;
    border: none;
    padding: 10px 16px;
    color: white;
    font-weight: 700;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
    margin-top: 12px;
  }
  #edit-modal button:hover {
    background-color: #09589e;
  }
  #edit-modal .close-btn {
    position: absolute;
    top: 10px;
    right: 16px;
    font-size: 23px;
    cursor: pointer;
    color: #555;
    font-weight: 700;
    user-select: none;
  }
  #edit-modal .close-btn:hover {
    color: #000;
  }
  #notification-bar {
    position: fixed;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #0c71c3;
    color: white;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    box-shadow: 0 0 14px rgba(12,113,195,0.6);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    user-select: none;
    z-index: 1050;
    max-width: 90vw;
    text-align: center;
    font-size: 15px;
  }
  #notification-bar.show {
    opacity: 1;
    pointer-events: auto;
  }
  footer {
    background: #0c71c3;
    color: white;
    padding: 14px 20px;
    text-align: center;
    font-size: 14px;
    margin-top: auto;
  }
  footer a {
    color: #aecfff;
  }
  .hidden {
    display: none !important;
  }
  .privacy-label {
    font-weight: 600;
    color: #666;
    font-size: 13px;
    margin-left: auto;
  }
  /* Scrollbar styling for comments */
  .comments-container::-webkit-scrollbar {
    height: 6px;
    width: 6px;
  }
  .comments-container::-webkit-scrollbar-thumb {
    background-color: #0c71c3aa;
    border-radius: 4px;
  }
  .comments-container::-webkit-scrollbar-track {
    background: #d9e6f11c;
  }
  @media (max-width: 860px) {
    #main-container {
      flex-direction: column;
      padding: 20px 12px 80px 12px;
    }
    #posts-section {
      margin-right: 0;
      max-width: 100%;
    }
    #sidebar {
      max-width: 100%;
      margin-top: 30px;
    }
  }
</style>
</head>
<body>
<header>
  <nav id="left-nav" aria-label="Main navigation">
    <button id="nav-home" class="active" aria-current="page">Home</button>
    <button id="nav-timeline">Timeline</button>
    <button id="nav-settings">Settings</button>
  </nav>
  <nav id="right-nav" aria-label="User actions">
    <button id="login-button">Login</button>
    <button id="logout-button" class="hidden">Logout</button>
  </nav>
</header>
<main id="main-container" aria-live="polite" aria-relevant="additions removals">
  <section id="posts-section" aria-label="Posts" role="region">
    <h2>All Posts</h2>
    <div id="posts-list" aria-live="polite" aria-live="assertive"></div>
  </section>
  <aside id="sidebar" aria-label="Sidebar">
    <!-- Login form -->
    <form id="login-form" novalidate>
      <h3>Login</h3>
      <label for="email-input">Email</label>
      <input type="email" id="email-input" placeholder="Enter email" autocomplete="username" required />
      <label for="password-input">Password</label>
      <input type="password" id="password-input" placeholder="Enter password" autocomplete="current-password" required />
      <button type="submit">Login</button>
      <p id="login-error" role="alert" aria-live="assertive"></p>
    </form>

    <!-- Admin Panel -->
    <div id="admin-panel" hidden>
      <h3>Account Info</h3>
      <div id="account-info"></div>
      <div id="account-stats"><strong>Today's Visits:</strong> <span id="visit-count">0</span></div>
      <button id="logout-button-sidebar">Logout</button>

      <section id="post-editor-section" aria-label="Create New Post">
        <h3>Create New Post</h3>
        <form id="post-editor" novalidate>
          <label for="post-title">Title</label>
          <input type="text" id="post-title" placeholder="Post Title" required aria-required="true"/>
          <label for="post-caption">Caption / Text</label>
          <textarea id="post-caption" placeholder="Description (optional)"></textarea>
          <label for="post-file">Choose Photo or Video</label>
          <input type="file" id="post-file" accept="image/*,video/*" />
          <label for="post-redirect-link">Redirect Link (optional)</label>
          <input type="url" id="post-redirect-link" placeholder="Optional redirect URL" />
          <label for="post-privacy">Privacy</label>
          <select id="post-privacy" aria-label="Post Privacy Setting">
            <option value="public" selected>Public (Visible to all)</option>
            <option value="private">Private (Only visible to me)</option>
          </select>
          <button type="submit">Create Post</button>
        </form>
      </section>

      <section id="settings-section" aria-label="Account Settings">
        <h3>Settings</h3>
        <label for="setting-name">Change Name</label>
        <input type="text" id="setting-name" placeholder="Full Name" />
        <label for="setting-profile-pic">Change Profile Picture URL</label>
        <input type="url" id="setting-profile-pic" placeholder="Profile Picture URL" />
        <button id="save-settings">Save Settings</button>
      </section>
    </div>
  </aside>
</main>

<!-- Edit Post Modal -->
<div id="edit-modal" role="dialog" aria-modal="true" aria-labelledby="edit-modal-title" aria-describedby="edit-modal-desc" tabindex="-1">
  <div class="modal-content">
    <button class="close-btn" aria-label="Close">&times;</button>
    <h3 id="edit-modal-title">Edit Post</h3>
    <form id="edit-post-form" novalidate>
      <label for="edit-post-title">Title</label>
      <input type="text" id="edit-post-title" required aria-required="true" />
      <label for="edit-post-caption">Caption / Text</label>
      <textarea id="edit-post-caption"></textarea>
      <label for="edit-post-file">Change Photo / Video (optional)</label>
      <input type="file" id="edit-post-file" accept="image/*,video/*" />
      <label for="edit-post-redirect-link">Redirect Link (optional)</label>
      <input type="url" id="edit-post-redirect-link" />
      <label for="edit-post-privacy">Privacy</label>
      <select id="edit-post-privacy" aria-label="Edit Post Privacy Setting">
        <option value="public">Public (Visible to all)</option>
        <option value="private">Private (Only visible to me)</option>
      </select>
      <label for="edit-post-date">Post Date</label>
      <input type="date" id="edit-post-date" required aria-required="true" />
      <button type="submit">Save</button>
      <button type="button" id="delete-post-btn" style="background:#e03c3c;margin-top:6px;">Delete Post</button>
    </form>
  </div>
</div>

<!-- Notification Bar -->
<div id="notification-bar" role="alert" aria-live="polite"></div>

<footer>
  <p>Contact: <a href="mailto:999farhanislam@gmail.com" target="_blank" rel="noopener noreferrer">999farhanislam@gmail.com</a> | WhatsApp: <a href="https://wa.me/01700000000" target="_blank" rel="noopener noreferrer">+8801700000000</a></p>
</footer>

<script>
(() => {
  'use strict';

  const ADMIN_EMAIL = "999farhanislam@gmail.com";
  const ADMIN_PASS = "site@100";
  const SECRET_KEY_FOR_ACCOUNT = "mahi";

  // Storage keys
  const STORAGE_KEYS = {
    POSTS: "pro-poster-posts",
    VISITS: "pro-poster-visits",
    ACCOUNT: "pro-poster-account",
    SESSION: "pro-poster-session",
  };

  // DOM elements
  const navHomeBtn = document.getElementById("nav-home");
  const navTimelineBtn = document.getElementById("nav-timeline");
  const navSettingsBtn = document.getElementById("nav-settings");

  const loginButton = document.getElementById("login-button");
  const logoutButton = document.getElementById("logout-button");
  const logoutButtonSidebar = document.getElementById("logout-button-sidebar");
  const loginForm = document.getElementById("login-form");
  const loginError = document.getElementById("login-error");
  const adminPanel = document.getElementById("admin-panel");

  const emailInput = document.getElementById("email-input");
  const passwordInput = document.getElementById("password-input");

  const accountInfoContainer = document.getElementById("account-info");
  const visitCountEl = document.getElementById("visit-count");

  const postEditorForm = document.getElementById("post-editor");
  const postTitleInput = document.getElementById("post-title");
  const postCaptionInput = document.getElementById("post-caption");
  const postFileInput = document.getElementById("post-file");
  const postRedirectInput = document.getElementById("post-redirect-link");
  const postPrivacySelect = document.getElementById("post-privacy");

  const settingNameInput = document.getElementById("setting-name");
  const settingProfilePicInput = document.getElementById("setting-profile-pic");
  const saveSettingsButton = document.getElementById("save-settings");

  const postsList = document.getElementById("posts-list");

  const editModal = document.getElementById("edit-modal");
  const editModalCloseBtn = editModal.querySelector(".close-btn");
  const editPostForm = document.getElementById("edit-post-form");
  const editPostTitleInput = document.getElementById("edit-post-title");
  const editPostCaptionInput = document.getElementById("edit-post-caption");
  const editPostFileInput = document.getElementById("edit-post-file");
  const editPostRedirectInput = document.getElementById("edit-post-redirect-link");
  const editPostPrivacySelect = document.getElementById("edit-post-privacy");
  const editPostDateInput = document.getElementById("edit-post-date");
  const deletePostBtn = document.getElementById("delete-post-btn");

  const notificationBar = document.getElementById("notification-bar");

  // Sections for navigation
  const postsSection = document.getElementById("posts-section");
  const sidebar = document.getElementById("sidebar");
  const loginSection = loginForm.parentElement; // sidebar

  // Global state
  let posts = [];
  let account = {
    name: "Admin",
    profilePic: "",
  };
  let session = {
    loggedIn: false,
  };
  let visitCount = 0;
  let currentView = "home"; // home, timeline, settings

  let editingPostId = null;

  // Util functions
  function saveToStorage(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }
  function loadFromStorage(key) {
    try {
      return JSON.parse(localStorage.getItem(key));
    } catch {
      return null;
    }
  }
  function generateUniqueId() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
  }
  function formatDateISOtoYYYYMMDD(iso) {
    if (!iso) return "";
    return iso.slice(0,10);
  }
  function formatDateForPost(dateStr) {
    if (!dateStr) return "";
    const parts = dateStr.split("-");
    if (parts.length !==3) return dateStr;
    return parts[2] + "-" + parts[1] + "-" + parts[0];
  }
  function escapeHtml(text) {
    if (!text) return "";
    return text.toString()
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }
  function showNotification(msg, duration = 3500) {
    notificationBar.textContent = msg;
    notificationBar.classList.add("show");
    setTimeout(() => {
      notificationBar.classList.remove("show");
    }, duration);
  }
  function incrementVisitCount() {
    let visitsData = loadFromStorage(STORAGE_KEYS.VISITS) || {};
    let todayKey = new Date().toISOString().slice(0,10).replace(/-/g,"");
    visitsData[todayKey] = (visitsData[todayKey] || 0) + 1;
    saveToStorage(STORAGE_KEYS.VISITS, visitsData);
    return visitsData[todayKey];
  }
  function getTodayVisitCount() {
    let visitsData = loadFromStorage(STORAGE_KEYS.VISITS) || {};
    let todayKey = new Date().toISOString().slice(0,10).replace(/-/g,"");
    return visitsData[todayKey] || 0;
  }

  // Loading/saving posts/account/session
  function savePosts() { saveToStorage(STORAGE_KEYS.POSTS, posts); }
  function loadPosts() {
    const loaded = loadFromStorage(STORAGE_KEYS.POSTS);
    if(Array.isArray(loaded)) posts = loaded;
    else posts = [];
  }
  function saveAccount() { saveToStorage(STORAGE_KEYS.ACCOUNT, account); }
  function loadAccount() {
    const a = loadFromStorage(STORAGE_KEYS.ACCOUNT);
    if(a && typeof a === "object") account = a;
  }
  function saveSession() { saveToStorage(STORAGE_KEYS.SESSION, session); }
  function loadSession() {
    const s = loadFromStorage(STORAGE_KEYS.SESSION);
    if(s && typeof s === "object") session = s;
  }

  // LOGIN/LOGOUT
  function login(email, password) {
    if(email.toLowerCase()===ADMIN_EMAIL.toLowerCase() && password===ADMIN_PASS) {
      session.loggedIn = true;
      saveSession();
      showNotification("Login successful");
      renderLoggedInUI();
      return true;
    }
    loginError.textContent = "Invalid email or password";
    return false;
  }
  function logout() {
    session.loggedIn = false;
    saveSession();
    renderLoggedOutUI();
    showNotification("Logged out successfully");
  }
  function renderLoggedInUI() {
    loginForm.style.display = "none";
    adminPanel.hidden = false;
    loginButton.classList.add("hidden");
    logoutButton.classList.remove("hidden");
    logoutButtonSidebar.classList.remove("hidden");

    emailInput.value = "";
    passwordInput.value = "";
    loginError.textContent = "";

    accountInfoContainer.textContent = `Name: ${account.name}`;
    settingNameInput.value = account.name;
    settingProfilePicInput.value = account.profilePic || "";

    visitCount = getTodayVisitCount();
    visitCountEl.textContent = visitCount;

    postEditorForm.style.display = "flex";

    setView(currentView);
    renderPosts();
  }
  function renderLoggedOutUI() {
    loginForm.style.display = "flex";
    adminPanel.hidden = true;
    loginButton.classList.remove("hidden");
    logoutButton.classList.add("hidden");
    logoutButtonSidebar.classList.add("hidden");

    setView("home");
    renderPosts();
  }

  // NAVIGATION VIEW
  function setView(view) {
    currentView = view;
    // Clear active on all nav buttons
    navHomeBtn.classList.remove("active");
    navTimelineBtn.classList.remove("active");
    navSettingsBtn.classList.remove("active");
    postsSection.style.display = "block";
    adminPanel.hidden = !session.loggedIn;

    if(view === "home") {
      navHomeBtn.classList.add("active");
      postsSection.querySelector("h2").textContent = "All Posts";
      // In home, show all public posts and private posts only visible to owner if logged in
    } else if(view === "timeline") {
      navTimelineBtn.classList.add("active");
      postsSection.querySelector("h2").textContent = "Timeline Posts";
      // Timeline means only posts visible to logged-in user or public: all posts if logged out
    } else if(view === "settings") {
      navSettingsBtn.classList.add("active");
      postsSection.style.display = "none";
      adminPanel.hidden = false;
    }
    renderPosts();
  }

  // POST RENDERING
  function filterPostsForView() {
    if(currentView === "home") {
      // Show all posts, exclude private posts if not logged in or owner
      return posts.filter(p => (p.privacy === "public") || (session.loggedIn && p.privacy === "private"));
    }
    if(currentView === "timeline") {
      // Timeline: if logged in, show all posts; else only public posts
      if(!session.loggedIn) return posts.filter(p => p.privacy==="public");
      return posts;
    }
    return [];
  }
  function renderPosts() {
    postsList.innerHTML = "";
    const viewPosts = filterPostsForView();
    if(viewPosts.length === 0) {
      postsList.innerHTML = "<p>No posts available.</p>";
      return;
    }
    const loggedIn = session.loggedIn;

    // Sort by date descending
    viewPosts.sort((a,b) => new Date(b.postDate) - new Date(a.postDate));

    viewPosts.forEach(post => {
      const postEl = document.createElement("article");
      postEl.className = "post";
      postEl.id = "post-" + post.id;
      postEl.tabIndex = 0;
      postEl.setAttribute("aria-label", "Post: " + post.title);

      // Post header: title and date and privacy icon
      const postHeader = document.createElement("div");
      postHeader.className = "post-header";

      const titleDate = document.createElement("div");
      titleDate.className = "post-title-date";
      titleDate.textContent = `${post.title} - ${formatDateForPost(post.postDate)}`;
      postHeader.appendChild(titleDate);

      // Privacy label
      const privacyLabel = document.createElement("div");
      privacyLabel.className = "privacy-label";
      privacyLabel.title = post.privacy === "private" ? "Private Post" : "Public Post";
      privacyLabel.textContent = post.privacy === "private" ? "🔒 Private" : "🌐 Public";
      postHeader.appendChild(privacyLabel);

      postEl.appendChild(postHeader);

      if(post.mediaData){
        const mediaDiv = document.createElement("div");
        mediaDiv.className = "post-media";

        if(post.mediaType.startsWith("image")){
          const img = document.createElement("img");
          img.src = post.mediaData;
          img.alt = escapeHtml(post.title);
          img.tabIndex = 0;
          if(post.redirectLink) {
            img.style.cursor = "pointer";
            img.title = "Click to go to redirect link";
            img.addEventListener("click", () => window.open(post.redirectLink, "_blank", "noopener"));
            img.addEventListener("keydown", e=>{
              if(e.key === "Enter" || e.key===" ") {
                e.preventDefault();
                window.open(post.redirectLink, "_blank", "noopener");
              }
            });
          }
          mediaDiv.appendChild(img);
        } else if(post.mediaType.startsWith("video")){
          const video = document.createElement("video");
          video.src = post.mediaData;
          video.controls = true;
          video.title = escapeHtml(post.title);
          video.tabIndex = 0;
          if(post.redirectLink) {
            video.style.cursor = "pointer";
            video.addEventListener("click", () => window.open(post.redirectLink, "_blank", "noopener"));
            video.addEventListener("keydown", e=>{
              if(e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                window.open(post.redirectLink, "_blank", "noopener");
              }
            });
          }
          mediaDiv.appendChild(video);
        }
        postEl.appendChild(mediaDiv);
      }

      if(post.caption){
        const captionEl = document.createElement("p");
        captionEl.className = "caption";
        captionEl.textContent = post.caption;
        postEl.appendChild(captionEl);
      }

      // Footer buttons
      const footer = document.createElement("footer");
      footer.className = "post-footer";

      const likeBtn = document.createElement("button");
      likeBtn.type = "button";
      likeBtn.className = "like-btn";
      likeBtn.setAttribute("aria-label", "Like post");
      likeBtn.tabIndex = 0;
      likeBtn.innerHTML = `👍 <span class="like-count">${post.likes}</span>`;
      footer.appendChild(likeBtn);

      const commentBtn = document.createElement("button");
      commentBtn.type = "button";
      commentBtn.className = "comment-btn";
      commentBtn.setAttribute("aria-label", "Comment on post");
      commentBtn.tabIndex = 0;
      commentBtn.innerHTML = `💬 <span class="comment-count">${post.comments.length}</span>`;
      footer.appendChild(commentBtn);

      const shareBtn = document.createElement("button");
      shareBtn.type = "button";
      shareBtn.className = "share-btn";
      shareBtn.setAttribute("aria-label", "Share post");
      shareBtn.tabIndex = 0;
      shareBtn.innerHTML = `🔗 Share <span class="share-count">(${post.shares})</span>`;
      footer.appendChild(shareBtn);

      const copyLinkBtn = document.createElement("button");
      copyLinkBtn.type = "button";
      copyLinkBtn.className = "copy-link";
      copyLinkBtn.setAttribute("aria-label", "Copy post link");
      copyLinkBtn.tabIndex = 0;
      copyLinkBtn.textContent = "Copy Link";
      footer.appendChild(copyLinkBtn);

      postEl.appendChild(footer);

      const commentsContainer = document.createElement("div");
      commentsContainer.className = "comments-container";
      commentsContainer.style.display = "none";
      commentsContainer.setAttribute("aria-live", "polite");
      commentsContainer.setAttribute("aria-label", "Post comments");
      post.comments.forEach(cmt=>{
        const commentEl = document.createElement("div");
        commentEl.className = "comment";
        commentEl.textContent = cmt.text;
        commentsContainer.appendChild(commentEl);
      });
      postEl.appendChild(commentsContainer);

      if(loggedIn && post.privacy === "private") {
        // Non-owner does not see private posts — filtered out earlier
      }

      if(loggedIn && isPostOwner(post)) {
        // Three dots (Admin menu)
        const threeDotsBtn = document.createElement("button");
        threeDotsBtn.className = "three-dots";
        threeDotsBtn.setAttribute("aria-haspopup","menu");
        threeDotsBtn.setAttribute("aria-label","Edit post menu");
        threeDotsBtn.textContent = "⋮";
        postEl.appendChild(threeDotsBtn);

        threeDotsBtn.onclick = (e) => {
          e.stopPropagation();
          openEditModalMenu(post.id);
        };
      }

      likeBtn.onclick = () => {
        if(!session.loggedIn){
          showNotification("Please login to like posts");
          return;
        }
        post.likes++;
        savePosts();
        renderPosts();
        showNotification("You liked the post");
      };

      commentBtn.onclick = () => {
        if(commentsContainer.style.display === "none") {
          commentsContainer.style.display = "block";
          if(!commentsContainer.querySelector("form")){
            const form = document.createElement("form");
            form.style.marginTop = "8px";
            const input = document.createElement("input");
            input.type = "text";
            input.placeholder = "Write a comment...";
            input.style.width = "100%";
            input.required = true;
            input.setAttribute("aria-label", "Comment input");
            input.autocomplete = "off";
            input.spellcheck = true;
            form.appendChild(input);

            form.onsubmit = (ev) => {
              ev.preventDefault();
              if(!input.value.trim()) return;
              post.comments.push({id: generateUniqueId(), text: input.value.trim()});
              savePosts();
              renderPosts();
              showNotification("Comment added");
            };
            commentsContainer.appendChild(form);
            input.focus();
          }
        } else {
          commentsContainer.style.display = "none";
        }
      };

      shareBtn.onclick = async () => {
        post.shares++;
        savePosts();
        renderPosts();
        const postUrl = window.location.origin + window.location.pathname + "?post=" + encodeURIComponent(post.id);
        try {
          if(navigator.share){
            await navigator.share({
              title: post.title,
              text: `Check out my post: ${post.title}`,
              url: postUrl,
            });
            showNotification("Shared successfully");
          } else {
            await navigator.clipboard.writeText(postUrl);
            showNotification("Link copied. Share now!");
          }
        } catch {
          await navigator.clipboard.writeText(postUrl);
          showNotification("Link copied. Share now!");
        }
      };

      copyLinkBtn.onclick = async () => {
        const postUrl = window.location.origin + window.location.pathname + "?post=" + encodeURIComponent(post.id);
        try {
          await navigator.clipboard.writeText(postUrl);
          showNotification("Post link copied");
        } catch {
          showNotification("Failed to copy. Please copy manually");
        }
      };

      postsList.appendChild(postEl);
    });
  }

  // Checks if current logged in user is owner (for now only one admin)
  function isPostOwner(post) {
    // Only admin (loggedIn true) owns posts for this app
    return session.loggedIn;
  }

  // Handle post submission
  async function handlePostSubmit(e) {
    e.preventDefault();
    const title = postTitleInput.value.trim();
    if(!title){
      showNotification("Title is required");
      return;
    }
    const caption = postCaptionInput.value.trim();
    let mediaFile = postFileInput.files[0];
    let mediaDataUrl = "";
    let mediaType = "";
    if(mediaFile){
      mediaType = mediaFile.type;
      try {
        mediaDataUrl = await readFileAsDataURL(mediaFile);
      } catch {
        showNotification("Failed to read file");
        return;
      }
    }
    const redirectLink = postRedirectInput.value.trim() || "";
    const privacy = postPrivacySelect.value;

    const postDate = new Date().toISOString().slice(0,10);

    const newPost = {
      id : generateUniqueId(),
      title,
      caption,
      mediaData: mediaDataUrl,
      mediaType,
      redirectLink,
      postDate,
      privacy,
      likes: 0,
      comments: [],
      shares: 0,
    };

    posts.push(newPost);
    savePosts();

    postTitleInput.value = "";
    postCaptionInput.value = "";
    postFileInput.value = "";
    postRedirectInput.value = "";
    postPrivacySelect.value = "public";

    renderPosts();
    showNotification("Post created successfully");
  }

  function readFileAsDataURL(file) {
    return new Promise((resolve, reject)=>{
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject(new Error("File read error"));
      reader.readAsDataURL(file);
    });
  }

  // Save settings
  function saveSettings() {
    const newName = settingNameInput.value.trim() || "Admin";
    const newProfilePic = settingProfilePicInput.value.trim();

    account.name = newName;
    account.profilePic = newProfilePic;
    saveAccount();
    accountInfoContainer.textContent = `Name: ${account.name}`;

    renderPosts();
    showNotification("Settings saved successfully");
  }

  // Edit modal
  function openEditModal(postId) {
    editingPostId = postId;
    const post = posts.find(p=>p.id===postId);
    if(!post) return;
    editPostTitleInput.value = post.title;
    editPostCaptionInput.value = post.caption || "";
    editPostRedirectInput.value = post.redirectLink || "";
    editPostPrivacySelect.value = post.privacy || "public";
    editPostDateInput.value = post.postDate || new Date().toISOString().slice(0,10);
    editPostFileInput.value = "";
    editModal.classList.add("active");
    editPostTitleInput.focus();
  }
  function closeEditModal() {
    editingPostId = null;
    editModal.classList.remove("active");
  }
  async function handleEditPostSubmit(e) {
    e.preventDefault();
    if(!editingPostId) {
      closeEditModal();
      return;
    }
    const post = posts.find(p=>p.id===editingPostId);
    if(!post) {
      closeEditModal();
      return;
    }
    const title = editPostTitleInput.value.trim();
    if(!title){
      showNotification("Title is required");
      return;
    }
    const caption = editPostCaptionInput.value.trim();
    const redirectLink = editPostRedirectInput.value.trim();
    const privacy = editPostPrivacySelect.value;
    const dateVal = editPostDateInput.value;

    if(!dateVal){
      showNotification("Date is required");
      return;
    }

    const newFile = editPostFileInput.files[0];
    let mediaDataUrl = post.mediaData;
    let mediaType = post.mediaType;
    if(newFile){
      try {
        mediaDataUrl = await readFileAsDataURL(newFile);
        mediaType = newFile.type;
      } catch {
        showNotification("Failed to read file");
        return;
      }
    }
    post.title = title;
    post.caption = caption;
    post.redirectLink = redirectLink;
    post.privacy = privacy;
    post.postDate = dateVal;
    post.mediaData = mediaDataUrl;
    post.mediaType = mediaType;

    savePosts();
    renderPosts();
    showNotification("Post updated successfully");
    closeEditModal();
  }
  function deletePost(postId) {
    if(!confirm("Are you sure you want to delete this post?")) return;
    posts = posts.filter(p=>p.id!==postId);
    savePosts();
    renderPosts();
    showNotification("Post deleted");
    closeEditModal();
  }

  // Contextual menu for post editing
  function openEditModalMenu(postId) {
    // Show modal for editing with delete option
    openEditModal(postId);
  }

  // Handle URL param post to scroll or focus
  function handleUrlPostParam(){
    const params = new URLSearchParams(window.location.search);
    const postId = params.get("post");
    if(postId){
      setTimeout(() => {
        const postEl = document.getElementById("post-" + postId);
        if(postEl){
          postEl.scrollIntoView({behavior:"smooth", block:"center"});
          postEl.focus();
        }
      }, 600);
    }
  }

  // Event listeners
  loginForm.addEventListener("submit", e=>{
    e.preventDefault();
    loginError.textContent="";
    const email = emailInput.value.trim();
    const pass = passwordInput.value;
    if(!email||!pass){
      loginError.textContent = "Email and password required";
      return;
    }
    login(email, pass);
  });
  logoutButton.addEventListener("click", () => logout());
  logoutButtonSidebar.addEventListener("click", () => logout());

  postEditorForm.addEventListener("submit", handlePostSubmit);
  saveSettingsButton.addEventListener("click", e=>{
    e.preventDefault();
    saveSettings();
  });

  editModalCloseBtn.addEventListener("click", closeEditModal);
  editPostForm.addEventListener("submit", handleEditPostSubmit);
  deletePostBtn.addEventListener("click", ()=>{
    if(editingPostId) deletePost(editingPostId);
  });

  editModal.addEventListener("click", e=>{
    if(e.target === editModal){
      closeEditModal();
    }
  });
  window.addEventListener("keydown", e=>{
    if(e.key === "Escape" && editModal.classList.contains("active")){
      closeEditModal();
    }
  });

  navHomeBtn.addEventListener("click", ()=> {
    setView("home");
  });
  navTimelineBtn.addEventListener("click", ()=> {
    if(!session.loggedIn) {
      showNotification("Please login to view timeline");
      return;
    }
    setView("timeline");
  });
  navSettingsBtn.addEventListener("click", ()=> {
    if(!session.loggedIn) {
      showNotification("Please login to access settings");
      return;
    }
    setView("settings");
  });

  // Initialize
  loadPosts();
  loadAccount();
  loadSession();

  incrementVisitCount();

  if(session.loggedIn){
    renderLoggedInUI();
  }else{
    renderLoggedOutUI();
  }
  handleUrlPostParam();

})();
</script>
</body>
</html>
